!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=4)}([function(e,t){e.exports=require("express-msteams-host")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("botbuilder-teams")},function(e,t,o){e.exports=o(5)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(6),r=o(7),i=o(8),a=o(9),s=o(0),l=o(2)("msteams");l("Initializing Microsoft Teams Express hosted App..."),o(10).config();const c=o(11),u=n(),m=process.env.port||process.env.PORT||3007;u.use(n.json({verify:(e,t,o,n)=>{e.rawBody=o.toString()}})),u.use(n.urlencoded({extended:!0})),u.set("view engine","ejs"),u.set("views",i.join(__dirname,"/")),u.use(a("tiny")),u.use("/scripts",n.static(i.join(__dirname,"web/scripts"))),u.use("/assets",n.static(i.join(__dirname,"web/assets"))),u.use(s.MsTeamsApiRouter(c)),u.use(s.MsTeamsPageRouter({root:i.join(__dirname,"web/")})),u.use((e,t,o)=>(t.removeHeader("Content-Security-Policy"),t.removeHeader("X-Frame-Options"),o())),u.use("/",n.static(i.join(__dirname,"web/"),{index:"index.html"})),u.set("port",m),r.createServer(u).listen(m,e=>{if(e)return console.error(e);l(`Server running on ${m}`)})},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("dotenv")},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),t.nonce={},n(o(12)),n(o(29))},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0});const r=o(13),i=o(3),a=o(0),s=o(2),l=o(14),{firstEntity:c,WIT_TOKEN:u}=o(15),m=o(16),d=s("msteams"),g=o(20),p=new m({accessToken:u});var f=o(23);const{Client:y}=o(24);var h=o(1);const b=new y({connectionString:process.env.DATABASE_URL,ssl:!0});b.connect();var v="",_="",T="",k="",w="",O="",S="",x="",A="",D="",N="";let C=E=class{constructor(e){this.Connector=e,this.inMemoryStorage=new r.MemoryBotStorage,this.universalBot=new r.UniversalBot(this.Connector).set("storage",this.inMemoryStorage),this.universalBot.use({botbuilder:(e,t)=>{e.sendTyping(),t()}}),this.universalBot.dialog("/",this.defaultDialog),this.universalBot.dialog("/help",this.helpDialog),this.universalBot.dialog("/showBookings",[function(e){console.log("email",D),b.query(`SELECT * FROM booking_transactions where email='${D}'`,(t,o)=>{if(t)throw t;console.log("response",o);const n=o.rows.map(t=>{var o=JSON.stringify(t.start_date).split("T")[0],n=JSON.stringify(t.end_date).split("T")[0];return console.log("res",t),new r.HeroCard(e).title("Booking Id: "+JSON.stringify(t.booking_id)).subtitle("Room_id: "+JSON.stringify(t.room_id)).text("startDate: "+f(o).format("MMM Do YYYY")+"<br/>End Date: "+f(n).format("MMM Do YYYY")+"<br/>start Time: "+JSON.stringify(t.start_time)+"<br/>End Time: "+JSON.stringify(t.end_time))}),i=new r.Message(e).attachmentLayout(r.AttachmentLayout.carousel).attachments(n).text(`There are ${o.rows.length} bookings with your email`);r.Prompts.text(e,i)}),e.endDialog()}]).reloadAction("startOver","Ok, starting over.",{matches:/^start over$|^start again$/i}),this.universalBot.dialog("/askFromstarting",[function(e){return""==k?void e.beginDialog("askforbuildingname"):void e.beginDialog("askfordatetime")},function(e,t){"one"==N&&(e.dialogData.room_id=t.response,A=e.dialogData.room_id),e.beginDialog("showBookingDialog")},function(e,t){b.query(`insert into booking_transactions(room_id,start_time,end_time,start_date,end_date,email,floor_number,building_name)\n     values('${A}','${S+":00"}','${x+":00"}','${w}','${O}','${D}','','${k}')`,(t,o)=>{t?e.send("error"+t):e.send('<b style="color:green">Your booking is confirmed<b> ')}),w="",O="",S="",x="","",T="",k="",D="",A="",e.endDialog()}]).endConversationAction("endBooking","Ok. Goodbye.",{matches:/^cancel$|^goodbye$/i,confirmPrompt:"This will cancel your booking. Are you sure?"}).reloadAction("startOver","Ok, starting over.",{matches:/^start over$|^start again$/i}),this.universalBot.dialog("/welcome_user",[function(e){var t=o(25);e.send(t)}]);this.universalBot.dialog("showBookingDialog",[function(e){b.query(`select r.room_id,r.room_number,f.floor_number from rooms as r\n        Inner join floor as f \n        ON r.floor_id=f.floor_id \n        where room_id='${A}'`,(e,o)=>{if(e)throw e;o.rows.map(e=>(t.attachments[0].content.body[1].facts[2].value=e.floor_number,t.attachments[0].content.body[1].facts[3].value=e.room_number))});var t=o(26);o(27);if(t.attachments[0].content.body[1].facts[1].value=k,t.attachments[0].content.body[1].facts[4].value=T,t.attachments[0].content.body[1].facts[5].value=f(w).format("MMM Do YYYY"),t.attachments[0].content.body[1].facts[6].value=f(O).format("MMM Do YYYY"),t.attachments[0].content.body[1].facts[7].value=S,t.attachments[0].content.body[1].facts[8].value=x,e.message&&e.message.value){var n={message:{subject:"Room Booking Details",body:{contentType:"Text",content:"The new cafeteria is open."},toRecipients:[{emailAddress:{address:e.message.value.email}}]}};return g.getAccessToken().then(function(e){v=e},function(e){console.error(">>> Error getting access token: "+e)}),h({url:"https://graph.microsoft.com/v1.0/me/sendMail",method:"POST",headers:{Authorization:`Bearer ${v}`},json:!0,body:n},function(t,o,n){t?console.log("------errror---",t):(console.log("sent"),e.send("Your booking details have been sent to your email "+e.message.value.email))}),D=e.message.value.email,t.attachments[0].content.body[1].facts[0].value=D,void e.endDialogWithResult()}e.send(t)},function(e,t){e.endDialogWithResult(t)}]),this.universalBot.dialog("askfordatetime",[function(e){var t=o(28);if(""!==T&&(console.log("room_choices",T),t.attachments[0].content.body[6].value=T),""!==w&&(console.log("start",w),""!==S&&(console.log("time",S),t.attachments[0].content.body[2].value=S),t.attachments[0].content.body[1].value=w),""!==O&&(console.log("start",O),""!==x&&(console.log("time",x),t.attachments[0].content.body[4].value=x),t.attachments[0].content.body[3].value=O),e.message&&e.message.value){if(w=e.message.value.startDate,O=e.message.value.endDate,S=e.message.value.startTime,x=e.message.value.endTime,T=e.message.value.room_type,!(w&&O&&S&&x))return e.send('<b style="color:red">All the fields are required, please select respective start and end time</b>'),void e.send(t);if(f(w).isBefore(f().format("YYYY-MM-DD"))||f(O).isBefore(f().format("YYYY-MM-DD")))return f(w).isBefore(f().format("YYYY-MM-DD"))?(e.send('<b style="color:red">Please select start date from today onwards</b>'),t.attachments[0].content.body[1].value="",t.attachments[0].content.body[3].value=O):f(w).isBefore(f().format("YYYY-MM-DD"))&&f(O).isBefore(f().format("YYYY-MM-DD"))?(e.send('<b style="color:red">Please select start date and end date from today onwards</b>'),t.attachments[0].content.body[1].value="",t.attachments[0].content.body[3].value=""):(e.send('<b style="color:red">Please select end date from today onwards</b>'),t.attachments[0].content.body[1].value=w,t.attachments[0].content.body[3].value=""),t.attachments[0].content.body[2].value=S,t.attachments[0].content.body[4].value=x,void e.send(t);var n=f(S,"HH:mm:ss a"),i=f(x,"HH:mm:ss a"),a=f.duration(i.diff(n));a=parseInt(a.asHours())+" hour and "+parseInt(a.asMinutes())%60+" minutes.",b.query(`select distinct room_id from booking_transactions where\n((start_time BETWEEN '${S}' and '${x}') or (end_time BETWEEN '${S}' and '${x}'))\nand((start_date BETWEEN '${w}' and '${O}')or(end_date BETWEEN '${w}' and '${O}'))\norder by room_id`,(t,o)=>{if(t)throw t;var n=o.rows.filter(e=>e.room_id);b.query(`select r.room_id,r.capacity,r.room_number,f.floor_number,rt.roomtype_id,b.building_id from rooms as r\n                                Inner join floor as f \n                                ON r.floor_id=f.floor_id \n                                Inner join room_Type as rt\n                                on r.roomtype_id=rt.roomtype_id\n                                Inner join building as b\n                                on r.building_id=b.building_id\n                                where room_type='${T}' AND building_name='${k}'`,(t,o)=>{if(t)throw t;var i=o.rows.filter(e=>{for(let t in n)if(e.room_id==n[t].room_id)return!1;return!0});const a=i.map(t=>new r.HeroCard(e).title("Room Id: "+JSON.stringify(t.room_id)).subtitle("Capacity: "+JSON.stringify(t.capacity)+"     Room Type:"+T).text(`<b>Room Number: ${JSON.stringify(t.room_number)}    Floor Number: ${t.floor_number}</b>`).images([r.CardImage.create(e,"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQe-kfvktz-yGOOtUgVKT41-cohHBf6bVyINEKXF54S5paPJh9S")]).buttons([r.CardAction.imBack(e,JSON.stringify(t.room_id),"Book")])),s=new r.Message(e).attachmentLayout(r.AttachmentLayout.carousel).attachments(a).text(`<b>There are ${i.length} rooms available as per your requirement.</b>`);r.Prompts.text(e,s)})})}else N="one",e.send(t)},function(e,t){e.endDialogWithResult(t)}]),this.universalBot.dialog("askforbuildingname",[function(e){var t="";b.query("SELECT * from building",(o,n)=>{if(o)throw o;for(let e of n.rows)t+=JSON.stringify(e.building_name).replace(/\"/g,"")+":";r.Prompts.choice(e,"Please tell in which building you want to book a room, ",t.split(":"))})},function(e,t){k=t.response.entity,e.endDialogWithResult()}]),this.universalBot.dialog("confirmDialog",[function(e){r.Prompts.text(e,"Please Enter your email to  confirm your booking")},function(e,t){e.endDialogWithResult(t)}]),this.universalBot.on("conversationUpdate",this.convUpdateHandler),this.Connector.onQuery("message",(e,t,o)=>{if(t.parameters&&t.parameters[0]&&"initialRun"===t.parameters[0].name){o(null,i.ComposeExtensionResponse.result("list").attachments([(new r.ThumbnailCard).title("Test").text("Test").images([(new r.CardImage).url("https://roombookingdemo.herokuapp.com/assets/icon.png")]).toAttachment()]).toResponse(),200)}else{o(null,i.ComposeExtensionResponse.result("list").attachments([(new r.ThumbnailCard).title("Test").text("test").images([(new r.CardImage).url("https://roombookingdemo.herokuapp.com/assets/icon.png")]).toAttachment()]).toResponse(),200)}}),this.Connector.onQuerySettingsUrl((e,t,o)=>{o(null,{composeExtension:{type:"config",suggestedActions:{actions:[{type:"openApp",title:"message Configuration",value:"https://roombookingdemo.herokuapp.com/messageConfig.html"}]}}},200)}),this.Connector.onSettingsUpdate((e,t,o)=>{t.state;o(null,null,200)})}defaultDialog(e){const t=E.extractTextFromMessage(e.message).toLowerCase();return p.message(t).then(({entities:t})=>{if(t.document)console.log(" coming first"),console.log("okkkkkkk"),g.getAccessToken().then(function(o){v=o,console.log("2nd"+v),console.log("sp");var n=JSON.stringify(t.document[0].value).replace(/\"/g,"");_="all"==n||"my"==n?"https://graph.microsoft.com/v1.0/me/drive/root/children??select=name,id,webURL&&top=10":`https://graph.microsoft.com/v1.0/me/drive/root/search(q='${n}')?select=name,id,webURL`,l.default.get(_,{headers:{Authorization:`Bearer ${v}`}}).then(function(t){var o="";const n=t.data.value.map(t=>{var n=t.name;switch(n.substr(n.indexOf("."))){case".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",o="https://cdn2.iconfinder.com/data/icons/metro-ui-icon-set/128/Word_15.png";break;case".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",o="https://cdn2.iconfinder.com/data/icons/metro-ui-icon-set/128/Excel_15.png";break;case".pptx":console.log("pptcoming"),"application/vnd.openxmlformats-officedocument.presentationml.presentation",o="https://cdn2.iconfinder.com/data/icons/metro-ui-icon-set/128/PowerPoint_15.png";break;case".pdf":"application/pdf",o="https://cdn4.iconfinder.com/data/icons/CS5/256/ACP_PDF%202_file_document.png"}return new r.HeroCard(e).title("Name: "+JSON.stringify(t.name)).subtitle("Web URL: "+JSON.stringify(t.webUrl)).images([r.CardImage.create(e,o)]).buttons([r.CardAction.openUrl(e,t.webUrl,"open")]).text("")}),i=new r.Message(e).attachmentLayout(r.AttachmentLayout.carousel).attachments(n).text(`There are ${t.data.value.length} documents exist with your requirement`);r.Prompts.text(e,i),e.endDialog()}).catch(function(e){console.log(e)})},function(e){console.error(">>> Error getting access token: "+e)});else{if(t.room_booking&&t.room_type&&t.building_name&&t.startenddatetime)return console.log("endstart"),w=JSON.stringify(t.startenddatetime[0].values[0].from.value).replace(/\"/g,"").split("T")[0],S=f(JSON.stringify(t.startenddatetime[0].values[0].from.value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),O=JSON.stringify(t.startenddatetime[0].values[0].to.value).replace(/\"/g,"").split("T")[0],x=f(JSON.stringify(t.startenddatetime[0].values[0].to.value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),T=JSON.stringify(t.room_type[0].value).replace(/\"/g,""),k=JSON.stringify(t.building_name[0].value).replace(/\"/g,""),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.room_type&&t.building_name&&t.startdatetime)return console.log("eyssafdsaf"),w=JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[0],T=JSON.stringify(t.room_type[0].value).replace(/\"/g,""),k=JSON.stringify(t.building_name[0].value).replace(/\"/g,""),S=f(JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.room_type&&t.startenddatetime)return console.log("endstart1"),w=JSON.stringify(t.startenddatetime[0].values[0].from.value).replace(/\"/g,"").split("T")[0],S=f(JSON.stringify(t.startenddatetime[0].values[0].from.value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),O=JSON.stringify(t.startenddatetime[0].values[0].to.value).replace(/\"/g,"").split("T")[0],x=f(JSON.stringify(t.startenddatetime[0].values[0].to.value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),T=JSON.stringify(t.room_type[0].value).replace(/\"/g,""),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.room_type&&t.startdatetime)return console.log("hey"),w=JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[0],T=JSON.stringify(t.room_type[0].value).replace(/\"/g,""),S=f(JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.building_name&&t.startdatetime)return console.log("hii"),k=JSON.stringify(t.building_name[0].value).replace(/\"/g,""),w=JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[0],S=f(JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.room_type&&t.building_name)return console.log("helo"),T=JSON.stringify(t.room_type[0].value).replace(/\"/g,""),k=JSON.stringify(t.building_name[0].value).replace(/\"/g,""),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.startdatetime)return console.log("hru"),w=JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[0],S=f(JSON.stringify(t.startdatetime[0].values[0].value).replace(/\"/g,"").split("T")[1]," hh:mm A").format("HH:mm A"),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.room_type)return console.log("say"),T=JSON.stringify(t.room_type[0].value).replace(/\"/g,""),console.log("coming1",w),void e.beginDialog("/askFromstarting");if(t.room_booking&&t.building_name)console.log("hmmmm"),k=JSON.stringify(t.building_name[0].value).replace(/\"/g,""),b.query(`SELECT * FROM building where building_name LIKE '%${k}%'`,(t,o)=>0==o.rows.length?void e.send("Sorry,there no building found with name "+k):void e.beginDialog("/askFromstarting"));else{if(t.show_bookings&&t.email)return console.log("hunnnn"),D=JSON.stringify(t.email[0].value).replace(/\"/g,""),void e.beginDialog("/showBookings");if(t.room_booking)return void e.beginDialog("/askFromstarting");e.beginDialog("/welcome_user"),e.endDialog()}}})}helpDialog(e){e.send("I'm just a friendly but rather stupid bot, and right now I don't have any valuable help for you!"),e.endDialog()}convUpdateHandler(e){d("Conversation update")}static extractTextFromMessage(e){var t=e.text?e.text:"";return e.entities&&e.entities.forEach(e=>{t=t.replace(e.text,"")}),t.trim()}};var E;C=E=n([a.BotDeclaration("/api/messages",process.env.MICROSOFT_APP_ID,process.env.MICROSOFT_APP_PASSWORD)],C),t.roombookingBot=C},function(e,t){e.exports=require("botbuilder")},function(e,t){e.exports=require("axios")},function(e,t){e.exports={WIT_TOKEN:"6YQU5ENYS3SLTGLSLVAY7A7SWWOF2GMG",firstEntity:function(e,t){return e&&e[t]&&Array.isArray(e[t])&&e[t]&&e[t][0]}}},function(e,t,o){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var o=[],n=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(o.push(a.value),!t||o.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return o}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=o(17),i=r.DEFAULT_API_VERSION,a=(r.DEFAULT_MAX_STEPS,r.DEFAULT_WIT_URL),s=o(18),l=o(19);var c=function(e,t){return function(o){var r=function(o){throw e.error("["+t+"] Error: "+o),o};if(o instanceof Error)return r(o);var i=n(o,2),a=i[0],s=i[1];if(a instanceof Error)return r(a);var l=a.error||200!==s&&a.body+" ("+s+")";return l?r(l):(e.debug("["+t+"] Response: "+JSON.stringify(a)),a)}},u=function(e){if(!e.accessToken)throw new Error("Could not find access token, learn more at https://wit.ai/docs");return e.witURL=e.witURL||a,e.apiVersion=e.apiVersion||i,e.headers=e.headers||{Authorization:"Bearer "+e.accessToken,Accept:"application/vnd.wit."+e.apiVersion+"+json","Content-Type":"application/json"},e.logger=e.logger||new l.Logger(l.INFO),e};e.exports=function e(t){if(!(this instanceof e))return new e(t);var o=this.config=Object.freeze(u(t)),n=(o.accessToken,o.apiVersion,o.headers),r=o.logger,i=o.witURL;this._sessions={},this.message=function(e,t,o,a,l){var u="q="+encodeURIComponent(e);t&&(u+="&context="+encodeURIComponent(JSON.stringify(t))),"number"==typeof o&&(u+="&n="+encodeURIComponent(JSON.stringify(o))),null!=a&&(u+="&verbose="+encodeURIComponent(JSON.stringify(a))),null!=l&&(u+="&junk=true");var m=i+"/message?"+u,d=c(r,"message");return r.debug("GET",m),s(m,{method:"GET",headers:n}).then(function(e){return Promise.all([e.json(),e.status])}).then(d)}}},function(e,t,o){"use strict";e.exports={DEFAULT_API_VERSION:"20160516",DEFAULT_MAX_STEPS:5,DEFAULT_WIT_URL:"https://api.wit.ai"}},function(e,t){e.exports=require("isomorphic-fetch")},function(e,t,o){"use strict";var n;function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var i=["debug","info","warn","error"],a=(r(n={},"debug",console.error.bind(console,"[wit][debug]")),r(n,"info",console.log.bind(console,"[wit]")),r(n,"warn",console.warn.bind(console,"[wit]")),r(n,"error",console.error.bind(console,"[wit]")),n),s=function(){};e.exports={Logger:function(e){var t=this;this.level=e||"info",i.forEach(function(o){var n=i.indexOf(o)>=i.indexOf(e);t[o]=n?a[o]:s})},DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error"}},function(e,t,o){var n=o(1),r=o(21),i=o(22),a={getAccessToken:function(){var e=r.defer();console.log("coming");var t={grant_type:"client_credentials",client_id:i.clientId,client_secret:i.clientSecret,resource:"https://graph.microsoft.com"};return n.post({url:i.tokenEndpoint,form:t},function(t,o,n){var r=JSON.parse(n);t?e.reject(t):r.error?e.reject(r.error_description):(console.log(r.access_token),e.resolve(r.access_token))}),e.promise}};e.exports=a},function(e,t){e.exports=require("q")},function(e,t){e.exports={clientId:"5dee4ed3-9f9e-4725-abbf-0298d4991a05",clientSecret:"(@?[X[:/XFi;1STwO1/sqU0rv",tokenEndpoint:"https://login.microsoftonline.com/b120d07c-d3c6-47a5-9f9c-640215ad6358/oauth2/token"}},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("pg")},function(e){e.exports={type:"message",inputHint:"expectingInput",text:"Hi! Welcome to room booking system at system!\n\nI'll help you book a room!",speak:"Hi! Welcome to room booking system at system! I'll help you book a room!",attachments:[{contentType:"application/vnd.microsoft.card.adaptive",content:{type:"AdaptiveCard",version:"1.0",body:[{type:"ColumnSet",columns:[{type:"Column",size:"auto",items:[{type:"Image",size:"medium",url:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSJSi6YxTAWfR0uP6VAXhNrLzrJPT_1luvPCpS71np_zWMGzbKm"}]},{type:"Column",items:[{type:"TextBlock",text:"Start with something like:",size:"large",weight:"bolder"},{type:"TextBlock",text:"'I want to book a room?'",separation:"none"},{type:"TextBlock",text:"or",separation:"none"},{type:"TextBlock",text:"'Book a room in garima park.'",separation:"none"},{type:"TextBlock",text:"You can also 'restart' or 'cancel' your booking anytime.",separation:"none"}]}]}]}}]}},function(e){e.exports={type:"message",attachments:[{contentType:"application/vnd.microsoft.card.adaptive",content:{type:"AdaptiveCard",version:"1.0",body:[{type:"TextBlock",text:"Booking Details",weight:"bolder",size:"medium"},{type:"FactSet",facts:[{title:"Email",value:""},{title:"Building Name:",value:""},{title:"Floor:",value:""},{title:"Room Number:",value:""},{title:"Room Type:",value:""},{title:"Start Date:",value:""},{title:"End date:",value:""},{title:"Start Time:",value:""},{title:"End Time:",value:""}]},{type:"Input.Text",placeholder:"Email",style:"email",maxLength:0,id:"email"}],actions:[{type:"Action.Submit",title:"Confirm"}]}}]}},function(e){e.exports={type:"AdaptiveCard",version:"1.0",body:[{type:"TextBlock",text:"Visit the Outlook Dev Portal",size:"large"},{type:"TextBlock",text:"Click **Learn More** to learn more about Actionable Messages!"},{type:"Input.Text",id:"feedbackText",placeholder:"Let us know what you think about Actionable Messages"}],actions:[{type:"Action.Http",title:"Send Feedback",method:"POST",url:"https://...",body:"{{feedbackText.value}}"},{type:"Action.OpenUrl",title:"Learn More",url:"https://docs.microsoft.com/outlook/actionable-messages"}]}},function(e){e.exports={type:"message",attachments:[{contentType:"application/vnd.microsoft.card.adaptive",content:{type:"AdaptiveCard",version:"1.0",backgroundImage:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRGQ9YqQ-o2XH21xk2Y4rlTNEN836vQKADEWUv0rXfTwso9MbnLpA",body:[{type:"TextBlock",text:"Please select the respective date and time for your booking.",wrap:!0},{type:"Input.Date",placeholder:"Start Date",id:"startDate",value:""},{type:"Input.Time",placeholder:"Start time",id:"startTime",value:""},{type:"Input.Date",placeholder:"End Date",id:"endDate",value:""},{type:"Input.Time",placeholder:"End time",id:"endTime",value:""},{type:"TextBlock",text:"What Type of room do you want to book?"},{type:"Input.ChoiceSet",id:"room_type",style:"compact",value:"",choices:[{title:"TR",value:"TR"},{title:"ODC",value:"ODC"},{title:"MPH",value:"MPH"},{title:"ANY",value:"true"}]}],actions:[{type:"Action.Submit",title:"Submit"}]}}]}},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0});const r=o(1),i=o(3),a=o(0),s=o(30);let l=class{constructor(){this.connectors=new s("connectors",!0,!1)}Connect(e){"myAppsState"===e.body.state&&this.connectors.push("/connectors[]",{webhookUrl:e.body.webhookUrl,user:e.body.user,appType:e.body.appType,groupName:e.body.groupName,existing:!0,color:e.body.color})}Ping(e){try{this.connectors.push("/connectors",this.connectors.getData("/connectors").filter(e=>e.existing))}catch(e){if(e.name&&"DataError"==e.name)return[];throw e}return this.connectors.getData("/connectors").map((e,t)=>new Promise((o,n)=>{const a=new i.O365ConnectorCard;a.title("Sample connector"),a.text("This is a sample Office 365 Connector"),a.themeColor(e.color);const s=new i.O365ConnectorCardSection;s.activityTitle("Ping"),s.activityText("This is just a sample ping");const l=new i.O365ConnectorCardFact;l.name("Created by"),l.value(e.user),s.facts([l]),a.sections([s]);const c=new i.O365ConnectorCardViewAction;c.name("Yo Teams"),c.target("http://aka.ms/yoteams"),a.potentialAction([c]),r({method:"POST",uri:decodeURI(e.webhookUrl),headers:{"content-type":"application/json"},body:JSON.stringify(a.toAttachment().content)},(e,r,i)=>{e?n(e):(410===r.statusCode&&this.connectors.push(`/connectors[${t}]/existing`,!1),o())})}))}};l=n([a.ConnectorDeclaration("/api/connector/connect","/api/connector/ping","web/roombookingConnectorConnect.ejs","/roombookingConnectorConnected.html")],l),t.roombookingConnector=l},function(e,t){e.exports=require("node-json-db")}]);
//# sourceMappingURL=server.js.map